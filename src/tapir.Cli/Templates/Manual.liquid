# Manual

A command-line tool for managing and executing automated api test cases.

## Description

`tapir` is a command-line tool designed to simplify the management and execution of automated API test cases.
With `tapir` you can create, organize, and run tests for your APIs, ensuring they function as expected.

## Domain Model

### TestCase

Represents a complete test case with metadata and test steps.

**Key Properties:**
- `Id`: Unique identifier (e.g., TC-Users-001)
- `Title`: Human-readable test case title
- `Module`: Logical grouping/module name
- `Type`: Either "Definition" or "Run"
- `Status`: "Passed", "Failed", or "Unknown"
- `Tables`: Collection of test step tables
- `Domain`: Base URL for API calls
- `Variables`: Dictionary of variables for substitution

### TestStep

Represents a single step in a test case.

**Key Properties:**
- `Id`: Sequential step number
- `Description`: Human-readable description
- `TestData`: Configuration data (Action=Send Method=GET Endpoint=users)
- `ExpectedResult`: Expected outcome description
- `IsSuccess`: Execution result flag

### TestStepInstruction

Parsed representation of a test step's test data.

**Supported Parameters:**
- `Action`: The action to perform (Send, AddHeader, CheckContent, etc.)
- `Method`: HTTP method (GET, POST, PUT, DELETE, PATCH)
- `Endpoint`: API endpoint path
- `Domain`: The domain to send the request to (will override the global domain and be prepended to the endpoint)
- `Name`: Header/parameter name
- `Value`: Header/parameter/content value
- `File`: File path for content or verification
- `JsonPath`: JSON path expression for extraction or verification
- `ContentType`: Content type (application/json, text/plain, multipart/form-data)

### Available Commands

**1. new** - Create a new test case definition
```bash
tapir new TC-Example-001 "My Test Title"
```

**2. validate** - Validate test case syntax
```bash
tapir validate TC-Example-001 -i ./tests
```

**3. run** - Execute test cases
```bash
tapir run https://api.example.com -tc TC-Example-001 -i ./tests -o ./results
```

**4. man** - Display action reference
```bash
tapir man
```

### Variable System

Variables enable request chaining by storing values from responses and using them in subsequent requests.

#### Variable Syntax

Variables use the `@@VariableName@@` syntax:

```markdown
| 05 | Store Alice's ID | Action=StoreVariable JsonPath=$[?@.name=="Alice"].id Name=AliceId | ID stored | - |
| 06 | Get Alice details | Action=Send Method=GET Endpoint=users/@@AliceId@@ | Request sent | - |
```

#### Variable Substitution

Variables are replaced in:
- `Value` fields
- `JsonPath` expressions
- `Endpoint` fields
- `Domain` fields

#### Variable Storage

Variables are stored using the `StoreVariable` action:
- Extract from JSON responses using JsonPath
- Store with a named key
- Available for all subsequent steps in the test case

### Test Case File Format

Test cases are written in Markdown with specific metadata:

```markdown
# TC-ID-001: Test Case Title

- **Date**: YYYY-MM-DD
- **Author**: author-name
- **Test Priority**: High|Medium|Low
- **Module**: ModuleName
- **Type**: Definition|Run
- **Status**: Passed|Failed|Unknown

## Description
Detailed description of what the test validates.

## Preconditions
- Any setup requirements

## Steps

| Step ID | Description | Test Data | Expected Result | Actual Result |
| ------: | ----------- | --------- | --------------- | ------------- |
| 01 | Step description | Action=Send Method=GET Endpoint=api/endpoint | Expected | - |

## Postcondition
- Any cleanup or final state
```

### Observability

tapir includes OpenTelemetry instrumentation for monitoring test execution.

#### Enable OTLP Export
```bash
tapir run https://api.example.com -tc TC-Example-001 --otel-endpoint http://localhost:4317
```

## Action Reference

`tapir` supports the following actions for Test Steps:
{% for action in Actions %}
### {{ action.Name }}

{{ action.Description }}

{% if action.SupportedProperties.size > 0 %}**Supported Properties:**
{%- for property in action.SupportedProperties %}
- {{ property }}
{%- endfor %}
{% endif %}
{%- endfor %}
